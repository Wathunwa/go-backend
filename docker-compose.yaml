services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
      target: api-runtime
    environment:
      # ใช้ค่าจาก Coolify Environment Variables
      DATABASE_URL: "postgres://postgres:fqu5gx7U7mEiMnhIlrlRIA1O4OoQFW2qhmEDuFtTq8rqfcgkcDMCCvor4T4uMsWf@157.245.202.214:27001/postgres"
      # ถ้าโค้ดคุณอ่านจาก APP_PORT ให้ตั้งด้วย (ปัจจุบัน main.go เปิด :22001 แล้ว)
      APP_PORT: ":22001"
    ports:
      - "22001:22001"
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:22001/healthz"]
      interval: 10s
      timeout: 3s
      retries: 10

  project_fiber:
    build:
      context: .
      dockerfile: Dockerfile
      target: project-runtime
    environment:
      DATABASE_URL: ${DATABASE_URL}
      PROJECT_PORT: ":22002"
    ports:
      - "22002:22002"
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:22002/healthz"]
      interval: 10s
      timeout: 3s
      retries: 10
